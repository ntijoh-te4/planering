= Versionshantering

För att skapa spårbarhet och enkelare kunna hitta när ett fel tillkom i ett mjukvaruprojekt versionshanteras i princip alltid källkod (och dokumentation). Git är det vanligaste versionshanteringssystemet. Kapitlet ger kunskaper om versionshantering med hjälp av Git och Github. 

Git är ett distribuerat versionssystem vilket betyder att alla filer och data finns på alla klienter. Du arbetar med dina ändringar lokalt på din dator där du kan arbeta med lokala versioner (`add` & `commit`). Sedan laddas alla versioner upp och till servern (`push`) och ner (`pull`) från servern.

Se följande tre videos för en överblick av versionshantering och Git:

* https://git-scm.com/video/what-is-version-control[Vad är versionshantering?] icon:play[]
* https://git-scm.com/video/what-is-git[Vad är Git?] icon:play[]
* https://git-scm.com/video/get-going[Börja med Git] icon:play[]



== How-to: Git & GitHub icon:map[]
En kort guide för att kunna skapa ett repository på Github dit du sedan kan ladda upp dina ändringar.

=== 1. Skapa och ladda ner ett repository på Github
Logga in på Github och skapa ett nytt repository i webbgränssnittet. Döp det till `learning-vcs`. Gör det privat och låt övrigt vara. Addressen till repositoriet finns både via `HTTPS` och `SSH`. Väljer du `HTTPS` får du göra `authentiseringen` (inloggningen) i webbläsaren, annars måste du skapa `SSH-nycklar` manuellt och ladda upp till ditt Github-konto.

Använd kommandot `git clone` i terminalen för att hämta ett repository till mappen du står i. Glöm inte ersätta `ntijoh-ola-lindberg` med din användare. 

----
git clone https://github.com/ntijoh-ola-lindberg/learning-vcs.git
----

För att se vilka filer som ändrats jämfört med filerna på servern används kommmandot `git status` och för att ladda ner uppdateringar från servern `git pull`.

icon:book[] Manualsidor: `man git-clone`, `man git-status`, `man git-pull`

=== 2. Lägg in en ny fil till i repository
Skapa filen `fil1.txt` och kolla status (`git status`). Din nya fil står som `Untracked` vilket betyder att den finns lokalt i mappen men `git` vet inte om att den finns.

Lägg till filen till `git` med `git add fil1.txt` vilket gör att `git` vet att filen finns. Med `git status` ser du att filen nu står som `Changes to be committed`.

En `commit` betyder att nuvarande version av filen är lagrad till `git`. Det går först nu att backa ändringar. Normalt görs en `commit` minst varje gånge en `todo` är avklarad. Lägg till filen med `git commit -m "Skapade dokumentet"`. 

Kolla status (`git status`). Din lokala version av repot är nu före serverns version av repot. Dina ändringar och versioner finns lokalt på datorn men inte på servern.

icon:book[] Manualsidor: `man git-add`, `man git-commit`

=== 3. Uppdatera en fil
Öppna, ändra och spara filen `fil1.txt`. Vad säger: `git status`?

Kör: `git commit -m "Skrev första stycket"` Sparas ändringarna till repositoriet?

Att spara ändringar i git är en tvåstegsraket. Först lägger du till vad som ska sparas med `git add` och sedan sparar du versionen med `git commit`. Kombinera de med `git commit -am "Skrev första stycket"`

=== 4. Ladda upp dina filer till Github
Ladda upp dina ändringar till Github med: `git push`. Försäkra dig om att de finns genom att öppna webbläsaren och se att ändringarna syns.

Se historiken med `git log --oneline` eller överkursvarianten: `git log --graph --decorate --abbrev-commit --all --pretty=oneline`

icon:book[] Manualsidor: `man git-push` & `man git-log`

== Läs
* https://education.github.com/git-cheat-sheet-education.pdf[Git cheat sheet] icon:book[]
* https://git-scm.com/book/[Den officiella Git-boken] icon:book[]
* https://www.youtube.com/watch?v=USjZcfj8yxE\[Kort, övergripande beskrivning] icon:play[]
* https://www.youtube.com/watch?v=RGOj5yH7evk[Lång genomgång - Git och GitHub] icon:play[]
* https://gist.github.com/luismts/495d982e8c5b1a0ced4a57cf3d93cf60[Git Commit Best Practices - Github gist] icon:play[]

== Git 1 övningar + quiz icon:graduation-cap[]

 * Gör några ändringar till i din fil. Ladda upp några versioner. Kolla på github så du ser alla versioner.
 * Lägg till fler filer och mappar. Kolla på Github så du ser dem.
 * Vad gör: `git add .` och `git add *` ?
 * Gör Git quiz 1

-

== Dela kod i Git - Delade repositories / branching & merging
Det finns minst två olika modeller för att samarbeta via Github. Ni kan antingen bjuda in alla som arbetar på projektet som collaborators via Github webbsidan. Detta funkar bäst till mindre projekt eller framförallt till projekt med färre deltagare.

I större projekt används oftast `fork and pull` där vem som helst kan göra en kopia på ett repository, arbeta i det och sedan be projektet lägga in in ändringarna `merge`.

Läs:

* https://docs.github.com/en/github/collaborating-with-pull-requests/getting-started/about-collaborative-development-models
* https://www.atlassian.com/git/tutorials/comparing-workflows

=== Branching och merging
Läs:
* https://www.atlassian.com/git/tutorials/using-branches/git-checkout
* https://www.atlassian.com/git/tutorials/using-branches/git-merge

När du lägger till en feature är ett vanligt sätt i Git-projekt att du skapar en branch, gör dina ändringar och sedan mergar tillbaka ändringarna till huvudkoden. Det finns flera fördelar. Bland annat skapas en isolerad miljö där du kan testa dina ändringar i lugn och ro utan att riskera att röra något i övriga projektet.

Som standard på Github får alla repositories en branch som heter `main`.

Skapa en ny och byt aktiv branch till din nya med kommandot: `git checkout -b ny-branch`. Se vilka branches som finns i repositoryt på din dator: `git branch`. Byter tillbaka till main: `git checkout main`.

När du arbetat färdigt gör du som vanligt, `git commit -ma "Ny feature"`. Du behöver dessutom ladda upp din nya branch till servern (den finns än så länge bara på din dator) och då måste du berätta till var den ska pushas: `git push --set-upstream origin ny-branch`.

När du arbetat färdigt i din nya branch är det dags att merga den till main.

Byt aktiv branch till main (`git checkout main`) och merga med: `git merge ny-branch`. Git försöker slå ihop filerna automatiskt men finns det ändringar på samma rad måste du hantera det manuellt. Då får du en sk. merge-konflikt (se bild).

image::git-merge-exempel-konflikt.png[]

När du mergat din branch kan du ta bort den med `git branch -d ny-branch`. Den försvinner lokalt men finns kvar på Github. Titta under branches i ditt repository på github.com.

`git diff` visar vilka ändringar som gjorts sedan commit. Det går även att jämföra olika branches.

Det går att använda VSCode som merge-verktyg: https://www.roboleary.net/vscode/2020/09/15/vscode-git.html

=== Arbetsmetoder med Git flow

.Föreläsningar
Projekthantering - GitHub flow

.GitHub project management
Tl;DR.
Använd Github Project Boards som kanban

Skapa issues för allt.
Assigna medlemmar till issues.
Skapa en branch för varje issue du jobbar med. Följ en naming convention.
Skapa en pull request för din branch.
Pull requests måste genomgå code review.

* https://docs.github.com/en/issues/tracking-your-work-with-issues/quickstart
* https://docs.github.com/en/get-started/quickstart/github-flow
* https://docs.github.com/en/issues/organizing-your-work-with-project-boards
* https://deepsource.io/blog/git-branch-naming-conventions/

.Miniövningar när allt annat är färdigt
* Ni som inte känner att ni kan göra mer med Git flow / pull requests / issues - uppgiften. Bygg ett shell-script som uppdaterar alla era Git-repositories (dvs kör git pull).
* Ni som är klara med både scriptet och github flow. Bygg ett script som gör GitHub issues från alla TODO-markeringar i er kod. Ni kan tex använda detta: https://github.com/marketplace/actions/todo-to-issue

== SSH och SSH-nycklar
För att kunna använda Git helt från terminalen behöver du logga in med SSH-nycklar. Det är ett säkert sätt att autentisera dig. Du skapar en privat och en publik nyckel, den publika laddas upp till Github och den privata sparar du på din dator. När du loggar in förstår Github vem du är automatiskt.

Läs:

* https://en.wikipedia.org/wiki/Secure_Shell
* https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh/about-ssh
* Om du använt Github desktop KANSKE den har skapat och lagt till nycklarna utan att du märkt det. Då kan du nog använda dem. Annars får vi skapa nya nycklar: https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent

== Git extra

I Git har vi några saker kvar.
Ni måste inte bli experter på alla dessa koncept men ni ska minst förstå hur de används för att enkelt kunna sätta er in i det senare. Vi kommer hålla små workshops med följande olika verktyg:

* Ändra historik i efterhand: https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History 
* git-cherry-pick: https://git-scm.com/docs/git-cherry-pick
* git-bisect: https://git-scm.com/docs/git-bisect
* GitHub CLI: https://github.com/cli/cli
* git-stash: https://git-scm.com/docs/git-stash

.Er uppgift

1). Lär er använda de verktyg ni fått.

2). Lär era klasskamrater använda verktyget. +
Svara minst på följande frågor:

 * Vad är det? / Vad används det till?
 * Hur funkar det? / Hur använder man det?
 * Varför använder man det?

3). Gör en kort demo när ni använder verktyget. Gärna i terminalen. Men inget måste.

---

== Git teori

Kunskaper om designen bakom git och vilka datastrukturer som används.

Kunskaper om att jobba mot en centraliserad remote (client-server).

=== Varför?

För att kunna förstå teorin bakom kommandon som används.

För att kunna dela kod med andra utvecklare.

=== Vad?

.Koncept:
* Datastrukturer
   - Mutable index
   - Object database
* Refs
   - HEAD
   - branches
   - tags
* Remotes
* Bare repositories

.Kommandon:
* git remote
* git fetch
* git push
* git pull
* git clone
* gh repo create


== Git CLI

Kunskap om vanliga kommandon och växlar för git.

=== Varför?

Git är i grunden terminalbaserat. Många grafiska utvecklingsverktyg saknar funktionalitet från Git CLI.

=== Vad?

.Kommandon
* git status
* git add
* git reset
* git commit
* git restore
* git log
* git branch
* git checkout
* git rm
* git merge
* git rebase
* git stash
* git cherry-pick

== Git arbetssätt

Kunskaper om att använda git som ett kollaborativt verktyg genom ett arbetsflöde.

=== Varför?

För att kunna jobba på samma kodbas med flera utvecklare.

=== Vad?

Kunna jobba med branches och git flow. Lösa merge conflicts.

.Branches:
* master
* develop
* feature
* release
* hotfix

.Koncept:
* Merge conflicts
* Diverging git history

== Issues

För att skapa tasks med labels och en assignee i github platformen.

=== Varför?

För att kunna jobba med issue tracking i git flow arbetsflödet.

=== Vad?

.Koncept

* Github issues

== Projects

Verktyg för projekthantering och skapa kanban boards för organisera issues.

=== Varför?

För att kunna spåra status av issues.

=== Vad?

.Koncept:
* Project boards

== Pull requests

Kunskaper om hur pull/merge requests används.

=== Varför?

För att kunna uppbehålla en konsekvent kodstandard och kodkvalité genom manuella och automatiserade code reviews.

=== Vad?

.Koncept:
* Pull requesuts

.Kommandon:
* gh pr create


